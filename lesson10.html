<!DOCTYPE html>
<html>
<head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
   	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
   	<script src="test.js"> </script>
    <meta charset="utf-8" />
    <title>Gamedev Canvas Workshop - lesson 2: move the ball</title>
    <style>
    html, body {
      width: 100%;
      height: 100%;
      margin: 0px;
      border: 0;
      overflow: hidden; /*  Disable scrollbars */
      display: block;  /* No floating content on sides */
    }
    </style>
</head>
<body>
	<div id="nocursor">
        <canvas id="myCanvas" width="480" height="320"></canvas>
    </div>
<script>
    (function() {
        var
        // Obtain a reference to the canvas element using its id.
        htmlCanvas = document.getElementById('myCanvas'),
        // Obtain a graphics context on the canvas element for drawing.
        context = htmlCanvas.getContext('2d');

       // Start listening to resize events and draw canvas.
       initialize();

       function initialize() {
           // Register an event listener to call the resizeCanvas() function 
           // each time the window is resized.
           window.addEventListener('resize', resizeCanvas, false);
           // Draw canvas border for the first time.
           resizeCanvas();
        }

        // Display custom canvas. In this case it's a blue, 5 pixel 
        // border that resizes along with the browser window.
        function redraw() {
           context.strokeStyle = 'white';
           context.lineWidth = '5';
           context.strokeRect(0, 0, window.innerWidth, window.innerHeight);
        }

        // Runs each time the DOM window resize event fires.
        // Resets the canvas dimensions to match window,
        // then draws the new borders accordingly.
        function resizeCanvas() {
            htmlCanvas.width = window.innerWidth;
            htmlCanvas.height = window.innerHeight;
            redraw();
        }
    })();

    </script>
<script>
	document.getElementById("nocursor").style.cursor = 'none';
	//var randomColor = "#000000".replace(/0/g,function(){return (~~(Math.random()*16)).toString(16);});
    var canvas = document.getElementById("myCanvas");
    var ctx = canvas.getContext("2d");
    var canvasPos = getPosition(canvas);
    var x = canvas.width/2;
    var y = canvas.height-30;
    var dx = 2;
    var dy = 2;
    var ballNumber = 30;
    var balls = [];
    var mouseX = 0;
    var mouseY = 0;

    canvas.addEventListener("mousemove", setMousePosition, false);


	for (c = 0; c < ballNumber; c++){
    	z = Math.floor(Math.random() * 2)
    	i = Math.floor(Math.random() * 100)
    	i1 = 3.8 + Math.random()*.6;
    	po = 1;
    	op = 50;
    	rendum = i
    	radiuss = 20;
    	if (z == 1){
    		po = -1
    		op = -100
    	}
    	if (i < 10){
    		i1 = 2 + Math.random()*.4;
    	}
    	if (i > 90){
    		i1 = 6.6 + Math.random()*.4;

    	}
    	if (rendum < 20){
    		radiuss = 14 - Math.random()*4;
    	}
    	if (rendum > 80){
    		radiuss = 26 + Math.random()*4;
    	}

    	balls[c] = {status: 1, x: Math.floor(Math.random() * 1000 + canvas.width), y: op + Math.floor(Math.random()*canvas.height), dx: -i1, dy: po*(Math.random()*1), radius: radiuss};
    }
    


	function setMousePosition(e) {
        mouseX = e.clientX - canvasPos.x;
        mouseY = e.clientY - canvasPos.y;
    }   
    function getPosition(el) {
        var xPosition = 0;
        var yPosition = 0;
 
        while (el) {
            xPosition += (el.offsetLeft - el.scrollLeft + el.clientLeft);
            yPosition += (el.offsetTop - el.scrollTop + el.clientTop);
            el = el.offsetParent;
        }
        return {
            x: xPosition,
            y: yPosition
        };
    }  

    




    function collision() {
    	for (c = 0; c < ballNumber; c++) {
    		if (Math.abs(mouseX - balls[c].x) < 16 + balls[c].radius && Math.abs(mouseY - balls[c].y) < 16 + balls[c].radius) {
    			balls[c].x = -100;
    			balls[c].y = -100;
    			balls[c].dx = 0;
    			balls[c].dy = 0;
    			balls[c].status = 0;
    		}
    	}
    }









    function drawEnemies() {
    	for (c = 0; c < ballNumber; c++){
        	ctx.beginPath();
        	ctx.arc(balls[c].x, balls[c].y, balls[c].radius, 0, Math.PI*2);
        	ctx.fillStyle = "#ff0000";
        	ctx.fill();
        	ctx.closePath();
    	}
    	
    }
    function drawBall() {
        
        ctx.beginPath();
        ctx.arc(mouseX, mouseY, 20, 0, Math.PI*2);
        ctx.fillStyle = "#0033ff";
        ctx.fill();
    }
   
    function draw() {
    	ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawEnemies();
        drawBall();


        for (c = 0; c < ballNumber; c++){

        	if (balls[c].x < 0 && balls[c].status == 1) {
        		balls[c].x = canvas.width;
        		balls[c].y = Math.floor(Math.random()*canvas.height);
        	}

    	
        	balls[c].x += balls[c].dx;
        	balls[c].y += balls[c].dy;
        
    	}

    	collision();


    	requestAnimationFrame(draw);

    }



    draw();
    
</script>
</body>
</html>
